{% extends "layouts/base.html" %}

{% block title %} Settings {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
<div class="pcoded-content">
    <div class="pcoded-inner-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="page-header-title">
                            <h5 class="m-b-10">Settings</h5>
                        </div>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/"><i class="feather icon-settings"></i></a></li>
                            <li class="breadcrumb-item"><a href="javascript:">Settings</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <div class="main-body">
            <!-- Page content -->
            <div class="container light-style flex-grow-1 container-p-y">
                <div class="card overflow-hidden">
                  <div class="row no-gutters row-bordered row-border-light">
                    <div class="col-md-3 pt-0">
                      <div class="card-body media align-items-center">
                          <img id= 'img-profile' src="{{ user.profile_img.url }}" width =250px alt="" class="d-block rounded-circle mx-auto img-responsive">
                      </div>
                      <div class="text-center text-capitalize">{{ user.role }}</div>
                      <h3 class="text-center text-primary ">{{ user.first_name }} {{ user.last_name }}</h3>
                      
                      <div class="list-group list-group-flush account-settings-links">
                        <a class="list-group-item list-group-item-action {% if 'account-general' in select %} active {% endif %} " data-toggle="list" href="#account-general">About</a>
                        <a class="list-group-item list-group-item-action {% if 'account-update' in select %} active {% endif %}" data-toggle="list" href="#account-update">Update Info</a>
                        <a class="list-group-item list-group-item-action {% if 'account-change-password' in select %} active {% endif %}" data-toggle="list" href="#account-change-password">Change password</a>
                        {% if user.is_superuser %}
                          <a class="list-group-item list-group-item-action {% if 'account-permissions' in select %} active {% endif %}" data-toggle="list" href="#account-permissions">User Permissions</a>
                        {% endif %}
                      </div>
                    </div>
                    <div class="col-md-9">
                      <div class="tab-content bg-light">
                        <div class="tab-pane fade {% if 'account-general' in select %} active show{% endif %} " id="account-general">
                          <h3 class="text-title"> About You</h3>
                          <div class="card-body">
                            <h4 class="card-title fw-bold"> Personal Info</h4>
                            <hr class="border-primary m-0">
                            <br>
                            <div class="row"> 
                              <div class="col-4">
                                <div class="fs-2 text-muted"> First Name : </div>
                                <h5 class="body-text">{{ user.first_name }}</h5>
                              </div>
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Last Name : </div>
                                <h5 class="card-title">{{ user.last_name }}</h5>                                
                              </div>
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Gender : </div>
                                {% if user.gender == 0 %}
                                  <h5 class="card-title">Male</h5>
                                {% else %}
                                  {% if user.gender == 1 %}
                                    <h5 class="card-title">Female</h5>
                                  {% else %}
                                    <h5 class="card-title">Not Specified</h5>
                                  {% endif%} 
                                {% endif %}
                              </div>
                            </div>
                            <br>
                            <h4 class="card-title fw-bold"> Contact Info</h4>
                            <hr class="border-primary m-0">
                            <br>
                            <div class="row">
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Mobile Number : </div>
                                <h5 class="card-title">{{ user.mobile_number }}</h5>                                
                              </div>
                              <div class="col-6">
                                <div class="fs-2 text-muted"> Email Address : </div>
                                <h5 class="card-title">{{ user.email }}</h5>                                
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Address 1 : </div>
                                <h5 class="card-title">{{ user.Address_1 }}</h5>                                
                              </div>
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Address 2 : </div>
                                <h5 class="card-title">{{ user.Address_2 }}</h5>                                
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-4">
                                <div class="fs-2 text-muted"> City : </div>
                                <h5 class="card-title">{{ user.city }}</h5>                                
                              </div>
                            </div>
                            <br>
                            <h4 class="card-title fw-bold"> Other Info</h4>
                            <hr class="border-primary m-0">
                            <br>
                            <div class="row">
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Account Created On : </div>
                                <h5 class="card-title">{{ user.created }}</h5>                                
                              </div>
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Last Login : </div>
                                <h5 class="card-title">{{ user.last_login }}</h5>                                
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Is Staff : </div>
                                {% if user.is_staff %}
                                  <h5 class="card-title text-success">Yes</h5>   
                                {% else %}                   
                                  <h5 class="card-title text-danger">No</h5> 
                                {% endif %}   
                              </div>
                              <div class="col-4">
                                <div class="fs-2 text-muted"> Is Active : </div>
                                {% if user.is_active %}
                                  <h5 class="card-title text-success">Yes</h5>   
                                {% else %}                   
                                  <h5 class="card-title text-danger">No</h5> 
                                {% endif %}                               
                              </div>
                              {% if user.is_superuser %}
                                <div class="col-4">
                                  <div class="fs-2 text-muted"> Is Admin : </div>
                                  <h5 class="card-title text-success">Yes</h5>                             
                                </div>
                              {% endif %}   
                            </div>
                          </div>
            
                        </div>
                        <div class="tab-pane fade {% if 'account-update' in select %} active show{% endif %}" id="account-update">
                          <h3 class="pb-1">Update your User Account</h3>
                          <div class="card-body pb-2">
                              <h4 class=" card-title">Personal Info</h4>
                              
                                {% if update_success %}
                                  <div class="alert alert-success">
                                     <bold>Update Success</bold> You have successfully Updated your profile!
                                  </div>
                                {% endif %} 

                              <form role="form" method="post" action="update" enctype="multipart/form-data">
                                  {% csrf_token %}        
                                  <div class="form-group">
                                      <div class="form-row">
                                          <div class="form-group col-md-6">
                                              {{form.user_name.label}} :
                                              <div class="input-group">
                                                  {{ form.user_name }}
                                              </div>
                                              {% if form.user_name.errors %}
                                                <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.user_name.errors }}</span>
                                              {% endif %}
                                          </div>
                                          <div class="form-group col-md-6">
                                              {{form.email.label}} : 
                                              <div class="input-group ">
                                                 <span class="input-group-text" id="">@</span> {{ form.email }}
                                              </div>
                                              {% if form.email.errors %}
                                                <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.email.errors }}</span> 
                                              {% endif %}
                                          </div>
                                      </div>
                                      <div class="form-row">
                                          <div class="form-group col-md-6">
                                              {{form.first_name.label}} : 
                                              <div class="input-group">
                                                  {{ form.first_name }}
                                              </div>
                                              {% if form.first_name.errors %}
                                                <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.first_name.errors }}</span> 
                                              {% endif %}
                                          </div>
                                          <div class="form-group col-md-6">
                                              {{form.last_name.label}} :
                                              <div class="input-group ">
                                                  {{ form.last_name }}
                                              </div>
                                              {% if form.last_name.errors %}
                                                <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.last_name.errors }}</span> 
                                              {% endif %} 
                                          </div>
                                      </div>
                                      <div class="form-row">
                                        <div class="form-group col-md-6">
                                            {{form.gender.label}} : 
                                            <div class="input-group">
                                                {{ form.gender }}
                                            </div>
                                            {% if form.gender.errors %}
                                              <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.gender.errors }}</span> 
                                            {% endif %} 
                                        </div>
                                        <div class="form-group col-md-6 ">
                                            {{form.profile_img.label}} :
                                            <div class="input-group "> 
                                                {{ form.profile_img }}
                                            </div>
                                            {% if form.profile_img.errors %}
                                              <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.profile_img.errors }}</span> 
                                            {% endif %}
                                        </div>
                                        <script>
                                          var id_profile_img = document.getElementById('id_profile_img');
                                          id_profile_img.onchange = function(event){
                                            var img = document.getElementById('img-profile');
                                            img.src = URL.createObjectURL(event.target.files[0]);
                                          };
                                        </script>
                                    </div>
                                  </div>
                                  <hr/>
                                  <h4 class="pb-1 card-title"> Contact Info</h4>
                                  <div class="form-group">
                                      <div class="form-row">
                                          <div class="form-group col-md-6">
                                              {{form.Address_1.label}} :
                                              <div class="input-group">
                                                  {{ form.Address_1 }}
                                              </div>
                                              {% if form.Address_1.errors %}
                                                <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.Address_1.errors }}</span> 
                                              {% endif %}
                                          </div>
                                          <div class="form-group col-md-6">
                                              {{form.Address_2.label}} :
                                              <div class="input-group ">
                                                  {{ form.Address_2 }}
                                              </div>
                                              {% if form.Address_2.errors %}
                                                <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.Address_2.errors }}</span> 
                                              {% endif %}
                                          </div>
                                      </div>
                                      <div class="form-row">
                                          <div class="form-group col-md-6">
                                              {{form.city.label}} :
                                              <div class="input-group">
                                                  {{ form.city }}
                                              </div>
                                              {% if form.city.errors %}
                                                <span role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.city.errors }}</span> 
                                              {% endif %}
                                          </div>
                                          <div class="form-group col-md-6">
                                              {{form.mobile_number.label}} :
                                              <div class="input-group ">
                                                  {{ form.mobile_number }}
                                              </div>
                                              {% if form.mobile_number.errors %}
                                                <div role="alert" class="alert alert-danger"><strong>Error!</strong>{{ form.mobile_number.errors }}</div> 
                                              {% endif %} 
                                          </div>
                                      </div>
                                  </div>
                                  <a class="btn-lg float-right btn-primary text-light" data-toggle="modal" data-target="#model_info_update_pass">Update</a>
                                  <br>
                                  <!-- User Profile Update Modal -->
                                  <div class="modal fade" id="model_info_update_pass" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h5 class="modal-title" id="exampleModalLabel">User Profile Update Confirmation</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                              <span aria-hidden="true">&times;</span>
                                            </button>
                                          </div>
                                          <div class="modal-body">
                                            You want really need to update your Profile informations?
                                          </div>
                                        <div class="modal-footer">
                                          <button href="{% url 'update'%}"  class="btn btn-primary">Confirm Update</button>
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                              </form>
                          </div>
                        </div>
                        <div class="tab-pane fade {% if 'account-change-password' in select %} active show{% endif %}" id="account-change-password">
                            <h3 class="text-title"> Reset Your Password</h3>
                            <br>
                            <div class="row">
                              <div class="form-group col-6">
                                <form role="form" method="post" action="reset_pass" enctype="multipart/form-data">
                                  {% csrf_token %} 
                                  <div class="form-row pb-3 ">
                                    {{form_reset.old_password.label}} :
                                    <div class="input-group">
                                      {{ form_reset.old_password }}
                                    </div>
                                    {% if form_reset.old_password.errors %}
                                      <div role="alert" class="alert alert-danger ">{{ form_reset.old_password.errors }}</div>
                                    {% endif %}
                                  </div>
                                  <div class="form-row pb-3">
                                    {{form_reset.password1.label}} :
                                    <div class="input-group">
                                      {{ form_reset.password1 }}
                                    </div>
                                    {% if form_reset.password1.errors %}  
                                      <div role="alert" class="alert alert-danger">{{ form_reset.password1.errors }}</div>
                                    {% endif %}
                                  </div>
                                  <div class="form-row">
                                    {{form_reset.password2.label}} :
                                    <div class="input-group">
                                      {{ form_reset.password2 }}
                                    </div>
                                    {% if form_reset.password2.errors %} 
                                      <div role="alert" class="alert alert-danger">{{ form_reset.password2.errors }}</div>
                                    {% endif %}
                                    {% if success %} 
                                      <div role="alert" class="alert alert-success">Your password was successfully updated!</div>
                                    {% endif %}
                                  </div>
                                  <br>
                                  <a  class="btn-lg float-right btn-primary text-light" data-toggle="modal" data-target="#model_reset_pass">Reset Password</a>
                                  
                                  <!-- Reset Password Modal -->
                                  <div class="modal fade" id="model_reset_pass" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h5 class="modal-title" id="exampleModalLabel">Password Resetting Confirmation</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                              <span aria-hidden="true">&times;</span>
                                            </button>
                                          </div>
                                          <div class="modal-body">
                                            You want really Reset your Password?
                                          </div>
                                        <div class="modal-footer">
                                          <button type="submit" class="btn btn-primary">Confirm Reset</button>
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </form>
                              </div>
                              <div class="col-md-6">
                                <img class="img-responsive d-block mx-auto opacity-50" width='300px' src='/static/assets/images/password-reset.png'>
                              </div>
                            </div>
                        </div>
                        <div class="tab-pane fade {% if 'account-permissions' in select %} active show{% endif %}" id="account-permissions">
                          <h3 class="text-title"> Manage the User Peermissions</h3>
                          <div class="card-body pb-1">
                            <div class="container">
                              
                              <div class="table-responsive">
                                <div class="table-wrapper">
                                  
                                <style>
                                  .table-responsive {
                                      margin: 30px 0;
                                  }
                                  .table-wrapper {
                                      min-width: 1000px;
                                      background: #fff;
                                      padding: 20px 25px;
                                      border-radius: 3px;
                                      box-shadow: 0 1px 1px rgba(0,0,0,.05);
                                  }
                                  .table-title {
                                      padding-bottom: 15px;
                                      background: #299be4;
                                      color: #fff;
                                      padding: 16px 30px;
                                      margin: -20px -25px 10px;
                                      border-radius: 3px 3px 0 0;
                                  }
                                  .table-title h2 {
                                      margin: 5px 0 0;
                                      font-size: 24px;
                                  }
                                  .table-title .btn {
                                      color: #566787;
                                      float: right;
                                      font-size: 13px;
                                      background: #fff;
                                      border: none;
                                      min-width: 50px;
                                      border-radius: 2px;
                                      border: none;
                                      outline: none !important;
                                      margin-left: 10px;
                                  }
                                  .table-title .btn:hover, .table-title .btn:focus {
                                      color: #566787;
                                      background: #f2f2f2;
                                  }
                                  .table-title .btn i {
                                      float: left;
                                      font-size: 21px;
                                      margin-right: 5px;
                                  }
                                  .table-title .btn span {
                                      float: left;
                                      margin-top: 2px;
                                  }
                                  table.table tr th, table.table tr td {
                                      border-color: #e9e9e9;
                                      padding: 12px 15px;
                                      vertical-align: middle;
                                  }
                                  table.table tr th:first-child {
                                      width: 60px;
                                  }
                                  table.table tr th:last-child {
                                      width: 100px;
                                  }
                                  table.table-striped tbody tr:nth-of-type(odd) {
                                      background-color: #fcfcfc;
                                  }
                                  table.table-striped.table-hover tbody tr:hover {
                                      background: #f5f5f5;
                                  }
                                  table.table th i {
                                      font-size: 13px;
                                      margin: 0 5px;
                                      cursor: pointer;
                                  }	
                                  table.table td:last-child i {
                                      opacity: 0.9;
                                      font-size: 22px;
                                      margin: 0 5px;
                                  }
                                  table.table td a {
                                      font-weight: bold;
                                      color: #566787;
                                      display: inline-block;
                                      text-decoration: none;
                                  }
                                  table.table td a:hover {
                                      color: #2196F3;
                                  }
                                  table.table td a.settings {
                                      color: #2196F3;
                                  }
                                  table.table td a.delete {
                                      color: #F44336;
                                  }
                                  table.table td i {
                                      font-size: 19px;
                                  }
                                  table.table .avatar {
                                      border-radius: 50%;
                                      vertical-align: middle;
                                      margin-right: 10px;
                                      width:50px;
                                  }
                                  .status {

                                      font-size: 30px;
                                      margin: 2px 2px 0 0;
                                      display: inline-block;
                                      vertical-align: middle;
                                      line-height: 10px;
                                  }
                                </style>
                                <table class="table table-striped table-hover">
                                  <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Name</th>						
                                        <th>Date Created</th>
                                        <th>Role</th>
                                        <th>Staff</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                    <tbody>
                                    {% for user_ in users %}
                                      {% if not user_.id == user.id %}
                                        <tr>
                                          <td>{{ user_.id }}</td>
                                          <td><a href="#"><img src="{{ user_.profile_img.url }}" class="avatar" alt=""> {{ user_.first_name }} {{ user_.last_name }}</a></td>
                                          <td>{{ user_.created }}</td>                        
                                          <td>{{ user_.role}}</td>
                                          <td>
                                            {% if user_.is_staff %}
                                              <span class="status text-success">&bull;</span> Yes
                                            {% else %}
                                              <span class="status text-danger">&bull;</span> No
                                            {% endif %}
                                            </td>
                                          <td>
                                          {% if user_.is_active %}
                                            <span class="status text-success">&bull;</span> Active
                                          {% else %}
                                            <span class="status text-danger">&bull;</span> Inactive
                                          {% endif %}
                                          </td>
                                          <td>
                                              <a href="#" class="settings" title="Settings" data-toggle="modal" data-target="#model_update_{{ user_.id }}"><i class="material-icons">&#xE8B8;</i></a>
                                              <a href="#" class="delete" title="Delete" data-toggle="modal" data-target="#model_delete_{{ user_.id }}"><i class="material-icons">&#xE5C9;</i></a>

                                              <!-- Delete Modal -->
                                              <div class="modal fade" id="model_delete_{{ user_.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                  <div class="modal-content">
                                                    <div class="modal-header">
                                                      <h5 class="modal-title" id="exampleModalLabel">User Deletion Confirmation</h5>
                                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                      </button>
                                                    </div>
                                                    <div class="modal-body">
                                                      <div class="text">You are about to delete one track url, this procedure is irreversible.</div>
                                                      <br>
                                                      <h5 class="modal-message"><strong>User Id        : {{ user_.id }}</strong></h5>
                                                      <h5 class="modal-message"><strong>User Name      : {{ user_.user_name }}</strong></h5>
                                                      <h5 class="modal-message"><strong>User Full Name : {{ user_.first_name }} {{ user_.last_name }}</strong></h5>
                                                      <br>
                                                      <div class='modal-message'>Do you want to proceed the delete opretion?</div>
                                                    </div>
                                                    <div class="modal-footer">
                                                      <form role="form" method="post" action="deleteUser">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="id" value="{{ user_.id }}">
                                                        <button type="submit" class="btn btn-danger">Delete</button>
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                      </form>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>

                                              <!-- Update Modal -->
                                              <div class="modal fade" id="model_update_{{ user_.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                  <div class="modal-content">
                                                    <div class="modal-header">
                                                      <h5 class="modal-title" id="exampleModalLabel">User Permission Updating</h5>
                                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                      </button>
                                                    </div>
                                                    <div class="modal-body">
                                                      <form role="form" method="post" action="SetUserPermissions">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="id" value="{{ user_.id }}">
                                                        <div class="row">
                                                          <div class="col">

                                                            <div class="form-group">
                                                              <div class="form-check">
                                                                {{ form_per.is_staff }}
                                                              </div>
                                                              <br>
                                                              <label class="form-check-label text-center">{{ form_per.is_staff.label }}</label>
                                                            </div>
                                                          </div>
                                                          <div class="col">
                                                            <div class="form-group">
                                                              <div class="form-check">
                                                                {{ form_per.is_active }}
                                                              </div>
                                                              <br>
                                                              <label class="form-check-label text-center">{{ form_per.is_active.label }}</label>
                                                            </div>
                                                          </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                          <button type="submit"  class="btn btn-primary">Update Permission</button>
                                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                        </div>
                                                      </form>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                          </td>
                                        </tr>
                                      {% endif %}
                                    {% endfor %}
                                    </tbody>
                                </thead>
                                </table>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            
              </div>
        </div>
    </div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}